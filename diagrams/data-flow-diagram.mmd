%% Diagrama de Fluxo de Dados - Simulador Financeiro
%% Este arquivo pode ser importado em:
%% - Mermaid Live Editor: https://mermaid.live/
%% - Draw.io: File > Import > Mermaid
%% - VS Code: Instalar extensão "Markdown Preview Mermaid Support"
%% - GitHub: Renderiza automaticamente em arquivos .md

flowchart TD
    %% Entidades Externas
    User([Utilizador])
    
    %% Processos Principais
    P1[Menu de Navegação]
    P2[Gestão de Master Data]
    P3[Gestão de Templates]
    P4[Criação de Versões]
    P5[Simulador Dinâmico]
    P6[Simulação Mês/Ano]
    P7[Gestão de Versões]
    
    %% Armazenamento de Dados
    D1[(Tabela: project)]
    D2[(Tabela: lang)]
    D3[(Tabela: lob)]
    D4[(Tabela: simulation_configs)]
    D5[(Tabela: simulation_configs_variables)]
    D6[(Tabela: simulation_versions)]
    D7[(Tabela: simulation)]
    
    %% Fluxo do Usuário para Menu
    User -->|Navegação| P1
    
    %% Menu para Processos
    P1 -->|Acesso| P2
    P1 -->|Acesso| P3
    P1 -->|Acesso| P4
    P1 -->|Acesso| P5
    P1 -->|Acesso| P6
    P1 -->|Acesso| P7
    
    %% Gestão de Master Data
    P2 <-->|CRUD Projetos| D1
    P2 <-->|CRUD Linguagens| D2
    P2 <-->|CRUD LOBs| D3
    D1 -->|id_prj| D2
    D2 -->|id_lang| D3
    
    %% Gestão de Templates
    P3 -->|Lê Projetos| D1
    P3 -->|Lê Linguagens| D2
    P3 <-->|CRUD Templates| D4
    P3 <-->|CRUD Variáveis Template| D5
    D1 -->|id_prj| D4
    D2 -->|id_lang| D4
    D4 -->|id_sim_cfg| D5
    
    %% Criação de Versões
    P4 -->|Lê Projetos| D1
    P4 -->|Lê Linguagens| D2
    P4 -->|Lê LOBs| D3
    P4 -->|Lê Template| D4
    P4 -->|Lê Variáveis Template| D5
    P4 -->|Cria Versão| D6
    P4 -->|Gera Registos Mensais| D7
    D5 -.->|Estrutura Base| D7
    
    %% Simulador Dinâmico
    P5 -->|Lê Projetos| D1
    P5 -->|Lê Versões| D6
    P5 <-->|CRUD Simulações| D7
    P5 -->|Calcula Valores| P5
    
    %% Simulação Mês/Ano
    P6 -->|Lê Projetos| D1
    P6 -->|Lê Linguagens| D2
    P6 -->|Lê LOBs| D3
    P6 -->|Lê Versões| D6
    P6 <-->|CRUD Simulações por LOB| D7
    P6 -->|Calcula Valores| P6
    
    %% Gestão de Versões
    P7 -->|Lê Projetos| D1
    P7 <-->|CRUD Versões| D6
    P7 -->|Visualiza Dados| D7
    
    %% Estilos
    classDef userClass fill:#e1f5ff,stroke:#01579b,stroke-width:3px
    classDef processClass fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef dataClass fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    
    class User userClass
    class P1,P2,P3,P4,P5,P6,P7 processClass
    class D1,D2,D3,D4,D5,D6,D7 dataClass
