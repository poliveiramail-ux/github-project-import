%% Diagrama de Sequência - Criação de Versão de Simulação
%% Este arquivo pode ser importado em ferramentas que suportam Mermaid

sequenceDiagram
    actor User as Utilizador
    participant UI as Interface SimulationForm
    participant DB as Supabase Database
    participant Calc as Sistema de Cálculo
    
    User->>UI: Seleciona Projeto e Linguagem
    UI->>DB: Query: Carregar Linguagens do Projeto
    DB-->>UI: Lista de Linguagens
    
    User->>UI: Seleciona Ano e Nome da Versão
    User->>UI: Clica "Criar Versão"
    
    UI->>DB: Query: Buscar Template (simulation_configs)
    DB-->>UI: Configuração do Template
    
    UI->>DB: Query: Buscar Variáveis do Template
    DB-->>UI: Lista de Variáveis
    
    UI->>DB: Query: Buscar LOBs (projeto + linguagem)
    DB-->>UI: Lista de LOBs
    
    UI->>DB: Insert: Criar simulation_versions
    DB-->>UI: ID da Nova Versão
    
    loop Para cada Variável × LOB × Mês (1-12)
        UI->>DB: Insert: Criar registo em simulation
        DB-->>UI: Confirmação
    end
    
    UI->>DB: Query: Carregar Versão Criada
    DB-->>UI: Dados da Versão
    
    UI->>Calc: Processar Valores Iniciais
    Calc->>Calc: Calcular Contas Pai (AUTO)
    Calc->>Calc: Avaliar Fórmulas (FORMULA)
    Calc-->>UI: Valores Calculados
    
    UI-->>User: Apresenta Versão Criada
    UI-->>User: Toast: "Versão criada com sucesso"
